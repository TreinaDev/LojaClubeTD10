<div class="m-3">
  <div class="m-lg-3 p-3 border shadow">
    <h2 class="mb-4 text-center">Finalize seu Pedido</h2>
    <div>
      <h3>Meus Dados</h3>
      <div class="border p-3">
        <p>Nome: <%= current_user.name %></p>
        <p>E-mail: <%= current_user.email %></p>
        <p>CPF: <%= current_user.formatted_cpf %></p>
        <p>Telefone: <%= current_user.formatted_phone %></p>
      </div>
    </div>
    <div>
      <h3 class="mt-3">Endereço de entrega</h3>
      <div class="border p-3">
        <p>Destinarário: <%= current_user.name %></p>
        <% unless @default_address.nil? %>
          <p><%= @default_address.address %>, <%= @default_address.number %></p>
          <p><%= @default_address.zipcode %> - <%= @default_address.city %> / <%= @default_address.state %></p>
        <% end %>
        <%= render 'addresses_list', user: current_user %>
      </div>
    </div>
    <div>
      <h3 class="mt-3">Itens da Compra</h3>
      <div class="border p-3">
        <table class="table table-striped table-hover mt-4 ">
          <thead>
            <tr class="text-center">
              <th>Produto</th>
              <th>Preço</th>
              <th>Quantidade</th>
              <th>Desconto</th>
              <th>Subtotal</th>
            </tr>
          </thead>
          <tbody class="table-group-divider">
            <% @shopping_cart.orderables.each do |orderable| %>
              <% product = orderable.product %>
              <div id="<%= "cart-#{product.id}" %>">
                <tr class="text-center">
                  <td><%= product.name %></td>
                  <td><%= price_in_points(product.price) %> Pontos</td>
                  <td><%= orderable.quantity %></td>
                  <td>0</td>
                  <td><%= price_in_points(product.price * orderable.quantity) %> Pontos</td>
                </tr>
              </div>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
    <div>
      <h3 class="mt-3">Pagamento</h3>
      <div class="border p-3">
      <table class="table table-striped table-hover mt-4 ">
        <thead>
          <tr class="text-center">
            <th>Subtotal</th>
            <th>Desconto</th>
            <th>Total do Pedido</th>
          </tr>
        </thead>
        <tbody class="table-group-divider">
            <div>
              <tr class="text-center">
                <td><%= price_in_points(@shopping_cart.total.round) %> Pontos</td>
                <td>0</td>
                <td><%= price_in_points(@shopping_cart.total.round) %> Pontos</td>
              </tr>
            </div>
        </tbody>
      </table>
        <div class="border p-3 mt-3">
          <%= form_with url: close_order_path, method: :post do |f| %>
            <div class="d-flex gap-3">
              <div>
                <%= f.label :card_number, 'Número do Cartão', class:'form-label mt-1' %>
              </div>
              <div>
                <%= f.text_field :card_number, class:'form-control' %>
              </div>
              <div>
                <%= f.submit 'Concluir compra', class:'btn btn-secondary' %>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
